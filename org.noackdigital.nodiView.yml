app-id: org.noackdigital.nodiView
runtime: org.gnome.Platform
runtime-version: '47'
sdk: org.gnome.Sdk
command: nodiview

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=home
  - --filesystem=xdg-pictures

modules:
  - name: libvips
    buildsystem: meson
    config-opts:
      - -Dintrospection=enabled
      - -Dgtk_doc=false
    sources:
      - type: archive
        url: https://github.com/libvips/libvips/releases/download/v8.15.2/vips-8.15.2.tar.xz
        sha256: a2ab15946776ca7721d11cae3215f20f1f097b370ff580cd44fc0f19387aee84

  - name: python3-dependencies
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --prefix=${FLATPAK_DEST} "Pillow>=10.0.0" "pyvips>=2.2.0"
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/P/Pillow/pillow-11.0.0.tar.gz
        sha256: 72bacbaf24ac003fea9bff9837d1eedb6088758d41e100c1552930151f677739
      - type: file
        url: https://files.pythonhosted.org/packages/source/p/pyvips/pyvips-2.2.3.tar.gz
        sha256: 455dc45a33d5c5eb8e4c9d9a6c3a88aa72f4474f49aac3b8c271e95c0a0aa08d

  - name: nodiview
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}"
        --prefix=${FLATPAK_DEST} . --no-build-isolation
      - install -Dm644 data/nodiview.desktop ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 data/icons/nodiview.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - install -Dm644 data/icons/nodiview.png ${FLATPAK_DEST}/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -Dm644 data/nodiview.appdata.xml ${FLATPAK_DEST}/share/metainfo/${FLATPAK_ID}.appdata.xml
    sources:
      - type: dir
        path: .
